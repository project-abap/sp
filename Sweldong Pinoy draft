"TODO: Night Diff, Gross Pay, GSIS Contrib
TYPE-POOLS: vrm.

TYPES:
  FLOAT TYPE P DECIMALS 2.

"Dropdowns"
DATA:
  vrm_id TYPE vrm_id,
  vrm_list TYPE vrm_values,
  vrm_item LIKE LINE OF vrm_list.

"Dropdown Declaration"
AT SELECTION-SCREEN OUTPUT.

   CLEAR vrm_list.
  vrm_id = 'emp_type'. "Employment Type"
  vrm_item-key = '1'.vrm_item-text = 'Private Employee'. APPEND vrm_item TO vrm_list.
  vrm_item-key = '2'.vrm_item-text = 'Government Employee'. APPEND vrm_item TO vrm_list.
  vrm_item-key = '3'.vrm_item-text = 'RHQ/ROHQ Employee'. APPEND vrm_item TO vrm_list.
  vrm_item-key = '4'.vrm_item-text = 'Minimum Wage Employee'. APPEND vrm_item TO vrm_list.

   CALL FUNCTION 'VRM_SET_VALUES' EXPORTING id = vrm_id values = vrm_list.

   CLEAR vrm_list.
  vrm_id = 'payr_prd'. "Payroll Period"
  vrm_item-key = '1'.vrm_item-text = 'Daily'. APPEND vrm_item TO vrm_list.
  vrm_item-key = '2'.vrm_item-text = 'Weekly'. APPEND vrm_item TO vrm_list.
  vrm_item-key = '3'.vrm_item-text = 'Semi-Monthly'. APPEND vrm_item TO vrm_list.
  vrm_item-key = '4'.vrm_item-text = 'Monthly'. APPEND vrm_item TO vrm_list.

   CALL FUNCTION 'VRM_SET_VALUES' EXPORTING id = vrm_id values = vrm_list.

  "Program Start dawg"
  START-OF-SELECTION.

  "Basic Inputs
  SELECTION-SCREEN BEGIN OF BLOCK B_INPUT WITH FRAME TITLE B_INPUT.

    PARAMETERS:
      emp_type(22) AS LISTBOX VISIBLE LENGTH 22 OBLIGATORY, " Employment Type "
      payr_prd(22) AS LISTBOX VISIBLE LENGTH 22 OBLIGATORY, " Payroll Period "
      no_days TYPE P LENGTH 8 DECIMALS 2 OBLIGATORY, " Number of Days "
      bsc_pay TYPE P LENGTH 8 DECIMALS 2 OBLIGATORY. " Basic Pay Input "

  SELECTION-SCREEN END OF BLOCK B_INPUT.

  "Basic Allowance Inputs
  SELECTION-SCREEN BEGIN OF BLOCK B_ALLOW WITH FRAME TITLE B_ALLOW.
    PARAMETERS:
      tax_awc TYPE P LENGTH 8 DECIMALS 2, " Taxable Allowance "
      ntax_awc TYPE P LENGTH 8 DECIMALS 2. " Non - Taxable Allowance "
  SELECTION-SCREEN END OF BLOCK B_ALLOW.

  "Night Differential
  SELECTION-SCREEN BEGIN OF BLOCK N_DIFF WITH FRAME TITLE N_DIFF.
    PARAMETERS:
      NIGHTD AS CHECKBOX USER-COMMAND ND, "Night Differential CB"
      ndHour TYPE I, "Night Differential Value
      ndiffRte TYPE P LENGTH 8 DECIMALS 2. "Night Differential Rate
  SELECTION-SCREEN END OF BLOCK N_DIFF.

  "Overtime
  SELECTION-SCREEN BEGIN OF BLOCK O_TIME WITH FRAME TITLE O_TIME.
    PARAMETERS:
      OVRTM AS CHECKBOX USER-COMMAND OT, "Overtime CheckBox"
      OTHours TYPE I, "OT Number of Hours
      OTRte TYPE P LENGTH 8 DECIMALS 2. "OT Rate
  SELECTION-SCREEN END OF BLOCK O_TIME.

  "Inome Rate"
  SELECTION-SCREEN BEGIN OF BLOCK INC_RATE WITH FRAME TITLE INC_RATE.
    PARAMETERS:
      mnthly RADIOBUTTON GROUP grp DEFAULT 'X', "Monthly
      s_mnthly RADIOBUTTON GROUP grp, "Semi-Monthly
      annual RADIOBUTTON GROUP grp.
  SELECTION-SCREEN END OF BLOCK INC_RATE.

  END-OF-SELECTION.

  "Blocks
  START-OF-SELECTION.

  INITIALIZATION.
    B_INPUT = 'Input'.
    B_ALLOW = 'Allowance'.
    N_DIFF = 'Night Differential'.
    O_TIME = 'Overtime'.
    INC_RATE = 'Rates'.
    
  "Multiplier"
  DATA: mult TYPE I VALUE 1.

  "Night Differential
  DATA: ndiffPay TYPE I VALUE 0, "Night Differential Pay
        OTPay TYPE I VALUE 0, "OT Pay
   "Other Data Declarations"
        gPay TYPE P DECIMALS 2, "Gross Pay
        whTax TYPE P DECIMALS 2, "Withholding Tax
        SSSc TYPE P DECIMALS 2, "SSS Contribution
        PHc TYPE P DECIMALS 2, "PhilHealth Contribution
        PIc TYPE P DECIMALS 2, "PagIbig Contributions
        totDeduc TYPE P DECIMALS 2, "Total Deductions
        NPay TYPE P DECIMALS 2. "Net Pay"
  END-OF-SELECTION.

  "Pay Multiplier"
  DATA: PayMult TYPE p DECIMALS 2. "Pay multiplier"

  "Payroll Period"
  IF payr_prd = '1'. "Daily"
    PayMult = no_days. "number of days

  ELSEIF payr_prd = '2'. "Weekly"
    PayMult = '4'. "number of days

  ELSEIF payr_prd = '3'. "Semi-Monthly"
    PayMult = '2'. "number of days

  ELSEIF payr_prd = '4'. "Monthly"
    PayMult = '1'. "number of days
  ENDIF.
  "Payroll Period End"


  "Monthly Payments"
  DATA: n_basPay TYPE p DECIMALS 2, "New Base Pay
        m_basPay TYPE p DECIMALS 2. "Monthly Base Pay

  n_basPay = n_basPay * payMult. "New Base Pay
  m_basPay = n_basPay. "Monthly Base Pay

  IF mnthly = 'X'.
    WRITE: / 'Monthly: True'.
    mult = '1'.
    n_basPay = ( n_basPay * mult ) .

  ELSEIF s_mnthly = 'X'. "Semi Monthly"
    mult = '0.5'.
    n_basPay = n_basPay * mult.

  ELSEIF annual = 'X'. "Annual
    mult = '12'.
    n_basPay = n_basPay * mult.
  ENDIF.
  "Monthly Payments End"

  "Allowance Computations"
  "tax_awc TYPE P LENGTH 8 DECIMALS 2, " Taxable Allowance "
  "ntax_awc
  DATA: taxable TYPE p DECIMALS 2,
       n_taxable TYPE p DECIMALS 2.

  taxable = ( tax_awc * PayMult ). "Taxable computation
  n_taxable = ( ntax_awc * PayMult ). "Non-Taxable computation

  IF mnthly = 'X'.
    mult = '1'.
    taxable = taxable * mult.
    n_taxable = n_taxable * mult.

  ELSEIF s_mnthly = 'X'. "Semi Monthly"
    mult = '0.5'.
    taxable = taxable * mult.
    n_taxable = n_taxable * mult.

  ELSEIF annual = 'X'. "Annual
    mult = '12'.
    taxable = taxable * mult.
    n_taxable = n_taxable * mult.
  ENDIF.
  "Allowance Computations End"

  "SSS Contribution
  IF m_basPay < 2250. "Monthly base pay less than 2250
    SSSc = 20.
  ELSEIF m_basPay >= 19750. "Monthly base pay greater than 19750
    SSSc = 800.
  ELSE.
    SSSc = ROUND( val = ( m_basPay / 500 ) dec = 0 ) * 20.
  ENDIF.

  IF mnthly = 'X'.
    mult = '1'.
    SSSc = SSSc * mult.

  ELSEIF s_mnthly = 'X'. "Semi Monthly"
    mult = '0.5'.
    SSSc = SSSc * mult.

  ELSEIF annual = 'X'. "Annual
    mult = '12'.
    SSSc = SSSc * 12.
  ENDIF.
  "SSS Contribution End

  "PhilHealth Contrib
  IF m_basPay <= 10000. "Monthly base pay less than equal to 10000
    PHc = '137.50'.
  ELSEIF m_basPay >= 40000. "Monthly base pay greater than equal to 40000
    PHc = '550'.
  ELSE.
    PHc = ( m_basPay * '0.0275' ) / 2.
  ENDIF.

  IF mnthly = 'X'.
    mult = '1'.
    PHc = PHc * mult.

  ELSEIF s_mnthly = 'X'. "Semi Monthly"
    mult = '0.5'.
    PHc = PHc * mult.

  ELSEIF annual = 'X'. "Annual
    mult = '12'.
    PHc = PHc * mult.
  ENDIF.
  "PhilHealth Contrib End

  "Pag Ibig Contrib
  IF m_basPay >= 5000. "Monthly base pay greater than equal to 5000
    PIc = 100.
  ELSEIF m_basPay < 1500. "Monthly base pay less than 1500
    PIc = m_basPay * '0.01'.
  ELSEIF bsc_pay >= 1500.
    PIc = m_basPay * '0.02'.
  ENDIF.

  IF mnthly = 'X'.
    mult = '1'.
    PIc = PIc * mult.

  ELSEIF s_mnthly = 'X'. "Semi Monthly"
    mult = '0.5'.
    PIc = PIc * mult.

  ELSEIF annual = 'X'. "Annual
    mult = '12'.
    PIc = PIc * mult.
  ENDIF.
  "Pag Ibig Contrib End

  "Witholding tax
  DATA: whTaxTotal TYPE p DECIMALS 2.

  IF emp_type = '4'. "Min Wage"
    whTax = 0.
  ELSE.
    whTaxTotal = ( m_basPay - ( SSSc + PHc + PIc ) ) + taxable.
    IF whTaxTotal <= 20833.
    whTax = 0.
    ELSEIF whTaxTotal > 20833 AND whTaxTotal <= 33333.
      whTax = ( whTaxTotal - 20833 ) * '.20'.
    ELSEIF whTaxTotal > 33333 AND whTaxTotal <= 66667.
      whTax = ( ( whTaxTotal - 33333 ) * '.25' ) + 2500.
    ELSEIF whTaxTotal > 66667 AND whTaxTotal <= 166667.
      whTax = ( ( whTaxTotal - 66667 ) * '.30' ) + '10833.33'.
    ELSEIF whTaxTotal > 166667 AND whTaxTotal <= 666667.
      whTax = ( ( whTaxTotal - 166667 ) * '.32' ) + '40833.33'.
    ELSEIF whTaxTotal > 666667.
      whTax = ( ( whTaxTotal - 666667 ) * '.35' ) + '200833.33'.
    ENDIF.
  ENDIF.

  IF mnthly = 'X'.
    mult = '1'.
    whTax = whTax * mult.

  ELSEIF s_mnthly = 'X'. "Semi Monthly"
    mult = '0.5'.
    whTax = whTax * mult.

  ELSEIF annual = 'X'. "Annual
    mult = '12'.
    whTax = whTax * mult.
  ENDIF.

  "Witholding tax End

  "Total Deductions"
  totDeduc = whTax + SSSc + PHc + PIc.
  "Total Deductions End"

  "Detrimental Computation" "HARMFUL COMPUTATION"
  gPay = bsc_pay + ntax_awc + ndiffPay + OTPay.

  "Get Total of All"
  WRITE: / 'Basic Pay: ', 90 bsc_pay.
  WRITE: / 'Taxable Allowance: ', 90 tax_awc.
  WRITE: / 'Non-Taxable Allowance: ', 90 ntax_awc.
  WRITE: / 'Night Differential Pay: ', 90 ndiffPay.
  WRITE: / 'Overtime Pay: ', 90 OTPay.
  WRITE: / 'Gross Pay: ', 90 gPay.
  WRITE: / 'Withholding Tax: ', 90 whTax.
  WRITE: / 'SSS Contribution: ', 90 SSSc.
  WRITE: / 'PhilHealth Contribution: ', 90 PHc.
  WRITE: / 'PAG-IBIG Contribution: ', 90 PIc.
  WRITE: / 'Total Deductions: ', 90 totDeduc.
  WRITE: / 'Net Pay: ', 90 NPay.
